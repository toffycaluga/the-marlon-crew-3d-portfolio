---
import es from '../i18n/es.json';
import en from '../i18n/en.json';
import LoadingScreen from './LoadingScreen.astro';

const initialLang = 'es';
const messagesByLang = { es, en };
const messages = messagesByLang[initialLang];
---

<div class="three-wrapper">
  <LoadingScreen />

  <canvas id="three-canvas"></canvas>

  <div class="overlay-ui">
    <select
      id="lang-switcher"
      class="lang-switcher"
      style="pointer-events: auto;"
    >
      <option value="es">ES</option>
      <option value="en">EN</option>
    </select>

    <div class="view-buttons">
      <button data-view="center">{messages.buttons.center}</button>
      <button data-view="trapecio">{messages.buttons.trapecio}</button>
      <button data-view="publico">{messages.buttons.publico}</button>
      <button data-view="entrada">{messages.buttons.entrada}</button>
      <button data-view="vestidores">{messages.buttons.vestidores}</button>
      <button data-view="equipos">{messages.buttons.equipos}</button>
      <button data-view="utileria">{messages.buttons.utileria}</button>
      <button data-view="contacto">{messages.buttons.contacto}</button>
    </div>

    <div class="view-panel" id="view-panel">
      <h2 id="view-title">{messages.panel.introTitle}</h2>
      <p id="view-description">{messages.panel.introDescription}</p>

      <form id="contact-form" class="contact-form" style="display:none;">
        <div class="form-group">
          <label id="label-name" for="contact-name">
            {messages.contact.form.nameLabel}
          </label>
          <input id="contact-name" name="name" type="text" required />
        </div>

        <div class="form-group">
          <label id="label-email" for="contact-email">
            {messages.contact.form.emailLabel}
          </label>
          <input id="contact-email" name="email" type="email" required />
        </div>

        <div class="form-group">
          <label id="label-event" for="contact-type">
            {messages.contact.form.eventTypeLabel}
          </label>
          <select id="contact-type" name="eventType">
            <option id="opt-show" value="show">
              {messages.contact.eventTypes.show}
            </option>
            <option id="opt-corp" value="corporativo">
              {messages.contact.eventTypes.corporativo}
            </option>
            <option id="opt-fest" value="festival">
              {messages.contact.eventTypes.festival}
            </option>
            <option id="opt-other" value="otro">
              {messages.contact.eventTypes.otro}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label id="label-msg" for="contact-message">
            {messages.contact.form.messageLabel}
          </label>
          <textarea
            id="contact-message"
            name="message"
            rows="3"
            placeholder={messages.contact.form.messagePlaceholder}
            required
          ></textarea>
        </div>

        <button id="submit-btn" type="submit" class="contact-submit">
          {messages.contact.form.submit}
        </button>

        <div class="contact-extra">
          <p id="extra-text">{messages.contact.extra.alsoText}</p>
          <ul class="contact-extra-list">
            <li>
              <strong id="extra-phone-label">
                {messages.contact.extra.phoneLabel}:
              </strong>
              {` ${messages.contact.extra.phoneValue}`}
            </li>
            <li>
              <strong id="extra-email-label">
                {messages.contact.extra.emailLabel}:
              </strong>
              {` ${messages.contact.extra.emailValue}`}
            </li>
          </ul>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
  .three-wrapper {
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    overflow: hidden;
    position: relative;
    background: #050509;
  }

  #three-canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  .overlay-ui {
    position: absolute;
    top: 1rem;
    left: 1rem;
    right: 1rem;
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    z-index: 10;
    pointer-events: none;
  }

  .lang-switcher {
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid #ffffff33;
    color: #fff;
    padding: 0.2rem 0.5rem;
    border-radius: 6px;
    font-size: 0.8rem;
  }

  .view-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    margin-left: 0.5rem;
    pointer-events: auto;
  }

  .view-buttons button {
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid #ffffff33;
    color: #f5f5f5;
    padding: 0.3rem 0.8rem;
    font-size: 0.8rem;
    border-radius: 999px;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.15s ease,
      border-color 0.2s ease;
  }

  .view-buttons button:hover {
    background: rgba(255, 255, 255, 0.12);
  }

  .view-buttons button.active {
    background: #f97316;
    border-color: #f97316;
    color: #111827;
    transform: translateY(-1px);
  }

  .view-panel {
    margin-left: auto;
    max-width: 340px;
    background: rgba(0, 0, 0, 0.65);
    border: 1px solid #ffffff22;
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    color: #f9fafb;
    font-size: 0.9rem;
    backdrop-filter: blur(8px);
    pointer-events: auto;
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .view-panel.is-updating {
    opacity: 0;
    transform: translateY(4px);
  }

  .view-panel h2 {
    margin: 0 0 0.4rem 0;
    font-size: 1rem;
  }

  .view-panel p {
    margin: 0 0 0.5rem 0;
    line-height: 1.4;
  }

  .contact-form {
    margin-top: 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .form-group label {
    font-size: 0.8rem;
    color: #e5e7eb;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    border-radius: 0.5rem;
    border: 1px solid #4b5563;
    background: rgba(15, 23, 42, 0.9);
    color: #f9fafb;
    padding: 0.35rem 0.5rem;
    font-size: 0.85rem;
    outline: none;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    border-color: #f97316;
  }

  .contact-submit {
    margin-top: 0.25rem;
    background: linear-gradient(90deg, #f97316, #ec4899);
    border: none;
    border-radius: 999px;
    color: #111827;
    font-weight: 600;
    padding: 0.4rem 0.9rem;
    font-size: 0.85rem;
    cursor: pointer;
    align-self: flex-end;
  }

  .contact-submit:hover {
    opacity: 0.9;
  }

  .contact-extra {
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: #e5e7eb;
  }

  .contact-extra-list {
    margin: 0;
    padding-left: 1rem;
  }
</style>

<script type="module">
  import { initThreeScene } from '/src/three/initScene.js';
  import { initI18nState } from '/src/scripts/i18nState.js';
  import { initUI } from '/src/scripts/uiController.js';
  import { initLoader } from '/src/scripts/loader.js';

  if (typeof window !== 'undefined') {
    window.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('three-canvas');
      if (!canvas) return;

      initI18nState();
      initLoader();
      initUI();
      initThreeScene(canvas);
    });
  }
</script>
