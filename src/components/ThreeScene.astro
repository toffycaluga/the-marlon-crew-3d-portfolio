---
import es from "../i18n/es.json";
import en from "../i18n/en.json";
import LoadingScreen from "./LoadingScreen.astro";

// ✅ Esto hace que Vite genere un asset con URL servida (/_astro/...)
import bootstrapUrl from "../scripts/bootstrapClient.js?url";

const initialLang = "es";
const messagesByLang = { es, en };
const messages = messagesByLang[initialLang];
---

<div class="three-wrapper">
  <LoadingScreen />

  <canvas id="three-canvas"></canvas>

  <div class="overlay-ui">
    <select id="lang-switcher" class="lang-switcher" style="pointer-events: auto;">
      <option value="es">ES</option>
      <option value="en">EN</option>
    </select>

    <div class="view-buttons">
      <button data-view="center">{messages.buttons.center}</button>
      <button data-view="trapecio">{messages.buttons.trapecio}</button>
      <button data-view="publico">{messages.buttons.publico}</button>
      <button data-view="entrada">{messages.buttons.entrada}</button>
      <button data-view="vestidores">{messages.buttons.vestidores}</button>
      <button data-view="equipos">{messages.buttons.equipos}</button>
      <button data-view="utileria">{messages.buttons.utileria}</button>
      <button data-view="contacto">{messages.buttons.contacto}</button>
    </div>

    <div class="view-panel" id="view-panel">
      <h2 id="view-title">{messages.panel.introTitle}</h2>
      <p id="view-description">{messages.panel.introDescription}</p>

      <form id="contact-form" class="contact-form" style="display:none;">
        <div class="form-group">
          <label id="label-name" for="contact-name">
            {messages.contact.form.nameLabel}
          </label>
          <input id="contact-name" name="name" type="text" required />
        </div>

        <div class="form-group">
          <label id="label-email" for="contact-email">
            {messages.contact.form.emailLabel}
          </label>
          <input id="contact-email" name="email" type="email" required />
        </div>

        <div class="form-group">
          <label id="label-event" for="contact-type">
            {messages.contact.form.eventTypeLabel}
          </label>
          <select id="contact-type" name="eventType">
            <option value="show">{messages.contact.eventTypes.show}</option>
            <option value="corporativo">{messages.contact.eventTypes.corporativo}</option>
            <option value="festival">{messages.contact.eventTypes.festival}</option>
            <option value="otro">{messages.contact.eventTypes.otro}</option>
          </select>
        </div>

        <div class="form-group">
          <label id="label-msg" for="contact-message">
            {messages.contact.form.messageLabel}
          </label>
          <textarea
            id="contact-message"
            name="message"
            rows="3"
            placeholder={messages.contact.form.messagePlaceholder}
            required
          ></textarea>
        </div>

        <button type="submit" class="contact-submit">
          {messages.contact.form.submit}
        </button>

        <div class="contact-extra">
          <p>{messages.contact.extra.alsoText}</p>
          <ul class="contact-extra-list">
            <li>
              <strong>{messages.contact.extra.phoneLabel}:</strong>
              {` ${messages.contact.extra.phoneValue}`}
            </li>
            <li>
              <strong>{messages.contact.extra.emailLabel}:</strong>
              {` ${messages.contact.extra.emailValue}`}
            </li>
          </ul>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
  .three-wrapper {
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    overflow: hidden;
    position: relative;
    background: #050509;
  }

  #three-canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  .overlay-ui {
    position: absolute;
    top: 1rem;
    left: 1rem;
    right: 1rem;
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    z-index: 10;
    pointer-events: none;
  }

  .lang-switcher {
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid #ffffff33;
    color: #fff;
    padding: 0.2rem 0.5rem;
    border-radius: 6px;
    font-size: 0.8rem;
  }

  .view-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    margin-left: 0.5rem;
    pointer-events: auto;
  }

  .view-buttons button {
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid #ffffff33;
    color: #f5f5f5;
    padding: 0.3rem 0.8rem;
    font-size: 0.8rem;
    border-radius: 999px;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.15s ease, border-color 0.2s ease;
  }

  .view-buttons button:hover {
    background: rgba(255, 255, 255, 0.12);
  }

  .view-panel {
    margin-left: auto;
    max-width: 340px;
    background: rgba(0, 0, 0, 0.65);
    border: 1px solid #ffffff22;
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    color: #f9fafb;
    font-size: 0.9rem;
    backdrop-filter: blur(8px);
    pointer-events: auto;
  }
</style>

<!-- ✅ ÚNICA carga de JS (bundleado por Vite, URL real http://.../_astro/...) -->
<script type="module" src={bootstrapUrl}></script>
